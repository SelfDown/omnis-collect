<html>
<header>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./index.css">
    <style>
        .input .el-textarea__inner {
            background-color: #fcfcfc;
        }
    </style>

</header>
<body style="padding: 0;margin: 0px">
<div id="app">
    <el-row style="padding: 10px;background: #f0fff0;height: 100%">

        <el-row>
            <el-col :span="16">
                <el-input v-model="url" placeholder="访问地址" size="mini"></el-input>
            </el-col>
            <el-col :span="8">
                <el-button-group style="display: flex;">

                    <el-button size="mini" type="primary" @click="post"> POST_BODY</el-button>
                    <el-button size="mini" type="primary" @click="download"> 下载文件</el-button>
                    <el-button size="mini" type="primary" @click="toJSON"> 格式化</el-button>
                </el-button-group>

            </el-col>

        </el-row>
        <el-col :span="4">
            <div>


                <a href="javascript:void (0)" @click="change('result6_search')">
                    添加sql server监控
                </a>
            </div>
            <div>


                <a href="javascript:void (0)" @click="change('result7_search')">
                    添加oracle监控
                </a>
            </div>
            <hr>
            <div>


                <a href="javascript:void (0)" @click="change('result5_search')">
                    根据key 获取zabbix 监控项
                </a>
            </div>
            <hr>
            <div>
                <a href="javascript:void (0)" @click="change('search')">
                    加载查询项目例子
                </a>
            </div>

            <div>
                <a href="javascript:void (0)" @click="change('search_filter')">
                    加载查询条件例子
                </a>
            </div>
            <div>
                <a href="javascript:void (0)" @click="change('save')">
                    加载新增数据例子
                </a>
            </div>
            <div>
                <a href="javascript:void (0)" @click="change('update')">
                    加载修改数据例子
                </a>
            </div>
            <div>
                <a href="javascript:void (0)" @click="change('delete')">
                    加载删除数据例子
                </a>
            </div>
            <div>
                <a href="javascript:void (0)" @click="change('bulk_create')">
                    加载批量创建的例子
                </a>
            </div>
            <div>
                <a href="javascript:void (0)" @click="change('result_search')">
                    加载按项目/月查询结果处理例子
                </a>
            </div>
            <div>
                <a href="javascript:void (0)" @click="change('result2_search')">
                    加载按人/月查询结果处理例子
                </a>
            </div>
            <div>
                <a href="javascript:void (0)" @click="change('result3_search')">
                    加载一级部门、二级部门名称
                </a>
            </div>
            <div>
                <a href="javascript:void (0)" @click="change('result4_search')">
                    加载查询用户处理例子
                </a>
            </div>
            <div>
                <a href="javascript:void (0)" @click="change('result8_search')" >
                    下载用户的例子
                </a>
            </div>

             <br/>
                <a href="javascript:void (0)" @click="change('result9_search')">
                    5.主机关联模板
                </a>
            <hr>
               <br/>
                <a href="javascript:void (0)" @click="change('result10_search')">
                    6.grafana 查询
                </a>

        </el-col>

        <el-col :span="8">


            <el-input
                    type="textarea"
                    class="input"
                    :rows="30"
                    placeholder="请输入请求内容"
                    v-model="params">
            </el-input>

        </el-col>
        <el-col :span="12">

            <el-input
                    class="input"
                    type="textarea"
                    :rows="2"
                    placeholder="返回内容"
                    v-model="result"
                    rows="30"
            >
            </el-input>

        </el-col>

    </el-row>
</div>


</body>

<script src="./vue.js"></script>
<script src="./axios.min.js"></script>
<!-- import JavaScript -->
<script src="./index.js"></script>
<script src="./jquery.min.js"></script>
<script>
    new Vue({
        el: '#app',
        data() {
            return {
                url: "/template_data/data",
                params: '{"service":"project_manage.project"}',
                result: "",
                urls: [],
                test: {
                    search: '{"service":"project_manage.project"}',
                    search_filter: '{"service":"project_manage.plan_task_query","start_date":"2021-01","end_date":"2021-12"}',
                    save: '{"service":"project_manage.plan_task_save","project_id":"cbh","user_id":"503","start_date":"2021-03-01","end_date":"2021-03-31","per":100}',
                    update: '{"service":"project_manage.plan_task_update","plan_task_id":"1","project_id":"cbh","user_id":"503","start_date":"2021-03-01","end_date":"2021-03-31","per":100}',
                    delete: '{"service":"project_manage.plan_task_delete","plan_task_id_list":["1"]}',
                    bulk_create: '{"service":"hrm.white_list_save","users":[1],"start_ym":"2022-01-01","end_ym":"2022-01-01"}',
                    result_search: '{"service":"project_manage.project_month_total","start_date":"2020-01-01","end_date":"2022-01-01"}',
                    result2_search: '{"service":"project_manage.man_month_total","start_date":"2020-01-01","end_date":"2022-01-01"}',
                    result3_search: '{"service":"project_manage.plan_task_query","start_date":"2020-01-01","end_date":"2022-01-01"}',
                    result4_search: '{"service":"hrm.user"}',
                    result5_search: '{"service":"server.key2item_ids","hostid":"10142","keys":["o_d_192.168.13.131","o_d_192.168.13.136"]}',
                    result6_search: '{"service":"monitor.oracle_delay_record_save","test_type":"6","test_proxy_param":{"install_soft_id":"1aa0207f-741e-412c-8eac-49fc05496da0","limit":"120","publication":"11"}}',
                    result7_search: '{"service":"monitor.oracle_delay_record_save","test_type":"3","test_install_soft_id":"1aa0207f-741e-412c-8eac-49fc05496da0"}',
                    result8_search: '{"service":"hrm.user"}',
                    result9_search: '{"service":"server.link_template","hostid_list":["10318"],"templateid_list":[10001,10348]}',
                    result10_search: '{"service":"grafana.query"}',
                }
            }
        },
        mounted() {

        },
        methods: {

            convertRes2Blob(response) {
              // 提取文件名
              const fileName = response.headers['content-disposition'].match(
                /filename=(.*)/
              )[1]
              // 将二进制流转为blob
              const blob = new Blob([response.data], { type: 'application/octet-stream' })
              if (typeof window.navigator.msSaveBlob !== 'undefined') {
                // 兼容IE，window.navigator.msSaveBlob：以本地方式保存文件
                window.navigator.msSaveBlob(blob, decodeURI(fileName))
              } else {
                // 创建新的URL并指向File对象或者Blob对象的地址
                const blobURL = window.URL.createObjectURL(blob)
                // 创建a标签，用于跳转至下载链接
                const tempLink = document.createElement('a')
                tempLink.style.display = 'none'
                tempLink.href = blobURL
                tempLink.setAttribute('download', decodeURI(fileName))
                // 兼容：某些浏览器不支持HTML5的download属性
                if (typeof tempLink.download === 'undefined') {
                  tempLink.setAttribute('target', '_blank')
                }
                // 挂载a标签
                document.body.appendChild(tempLink)
                tempLink.click()
                document.body.removeChild(tempLink)
                // 释放blob URL地址
                window.URL.revokeObjectURL(blobURL)
              }
            },

            download(){


                    let _this = this
                    axios.post(this.url, JSON.parse(this.params),{
                        responseType:"blob"
                    }).then(res => {
                            debugger
                          if (res.data instanceof  Blob){
                              this.convertRes2Blob(res)

                          }else{
                             _this.result = JSON.stringify(res.data, null, "\t")
                          }


                    })

            },
            change(t) {

                try {
                    this.params = JSON.parse(this.test[t])
                    this.params = JSON.stringify(this.params, null, "   ")
                } catch (e) {
                    this.params = this.test[t]
                }
            },
            async get() {
                var data = {}
                try {
                    data = JSON.parse(this.params)
                } catch (e) {

                }


                const response = await API.GET(this.url, data)
                if (response && response.data) {
                    this.result = JSON.stringify(response.data, null, "\t")
                } else {
                    this.result = response
                }

            },
            async post() {
                var data = {}
                try {
                    data = JSON.parse(this.params)
                } catch (e) {

                }
                let _this = this
                $.ajax({
                    url: _this.url,
                    type: "post",
                    data: _this.params,
                    contentType: "application/json",
                    success: function (res) {
                        _this.result = JSON.stringify(res, null, "\t")
                    },
                    error: function (res) {
                        _this.result = res.responseText

                    }
                })


            },

            async post_params() {
                var data = {}
                try {
                    data = JSON.parse(this.params)
                } catch (e) {

                }


                const response = await API.POST_PARAMS(this.url, data)
                if (response && response.data) {
                    this.result = JSON.stringify(response.data, null, "\t")
                } else {
                    this.result = response
                }

            },

            async put() {
                var data = {}
                try {
                    data = JSON.parse(this.params)
                } catch (e) {

                }


                const response = await API.PUT(this.url, data)
                if (response && response.data) {
                    this.result = JSON.stringify(response.data, null, "\t")
                } else {
                    this.result = response
                }

            },
            toJSON() {
                // this.params = JSON.stringify(this.params)
                this.params = JSON.parse(this.params)
                this.params = JSON.stringify(this.params, null, "   ")
            },
            async remove() {
                var data = {}
                try {
                    data = JSON.parse(this.params)
                } catch (e) {

                }


                const response = await API.DELETE(this.url, data)
                if (response && response.data) {
                    this.result = JSON.stringify(response.data, null, "\t")
                } else {
                    this.result = response
                }

            }

        }


    })
</script>

</html>