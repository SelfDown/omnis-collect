service:
  - key: "get_group_name"
    module: 'monitor'
    name: 查询分组
    params:
      name:
        check:
          template: "{{name|must}}"
          err_msg: "名称不能为空"
    data_json: group_get.json
    result_handler:
      - key: arr2obj
  - key: "monitor_group"
    module: 'monitor'
    name: 查询监控分组
    data_json: monitor_group.json
    result_handler:
      - key: new_col
        params:
          to_field:
            - field: children
              template: "templates"
            - field: id
              template: 'groupid'
            - field: type
              template: 'group'
          remove:
              - templates
              - groupid
      - key: new_col
        params:
          field: children
          to_field:
            - field: id
              template: 'templateid'
            - field: pid
              template: "{{parent.id}}"
            - field: type
              template: 'template'

  - key: "create_project_group"
    module: 'monitor'
    name: 创建分组
    log: true
    params:
      name:
        check:
          template: "{{name|must}}"
          err_msg: "名称不能为空"
    data_json: group_create.json
    result_handler:
      - key: arr2obj
        params:
          field: groupids
      - key: new_col
        params:
          to_field:
            - field: groupid
              template: "{{groupids}}"
          remove:
            - groupids



  - key: "project_group_id"
    module: 'service_flow'
    must_login: false
    log: true
    params:
      group_name:
        template: "{{'monitor_group_name'|get_key}}"
    flow:
      services:
        - key: start
          type: start
          name: 开始
          next: get_group
        - key: get_group
          type: node
          name: 获取分组
          service:
            service: 'monitor.get_group_name'
            name: group_name
          save_field: 'group'
          next: "{%if group.groupid%}end{%else%}create_project_group{% endif %}"
          fail: end
        - key: create_project_group
          type: node
          name: 创建分组
          service:
            service: 'monitor.create_project_group'
            name: group_name
          save_field: 'group'
          next: end
          fail: end
        - key: end
          type: end
          name: 结束
    result_handler:
      - key: add_param
        params:
          from_field: group
          to_field: group
      - key: new_col
        params:
          to_field:
            - field: "groupid"
              template: "{{group.groupid}}"
          remove:
            - group


